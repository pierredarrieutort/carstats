var e=require("@babel/runtime/helpers/toArray"),t=require("@babel/runtime/helpers/defineProperty"),r=require("@babel/runtime/helpers/slicedToArray"),a=require("@babel/runtime/helpers/createClass"),n=require("@babel/runtime/helpers/classCallCheck"),u=require("@babel/runtime/helpers/asyncToGenerator"),s=require("@babel/runtime/helpers/getPrototypeOf"),o=require("@babel/runtime/helpers/possibleConstructorReturn"),i=require("@babel/runtime/helpers/inherits"),d=require("@babel/runtime/regenerator"),c=require("@babel/runtime/helpers/interopRequireDefault"),l=c,f={};Object.defineProperty(f,"__esModule",{value:!0});var p=function(){var e=document.getElementById("forgotPassword");e.addEventListener("submit",(function(t){t.preventDefault();var r=new FormData(e);(new h.AuthApi).forgotPassword({email:r.get("email")})}))};f.default=p;var h={},m=c;Object.defineProperty(h,"__esModule",{value:!0});var v=(U=void 0,B=h.default=U,h.AuthApi=B);h.StatsApi=v;var w=m(d),b=m(i),y=m(o),g=m(s),k=m(u),O=m(n),P=m(a),j=m({DOMAIN_URL:"https://carstats-backend.herokuapp.com",MAPBOXGL:{ACCESS_TOKEN:"pk.eyJ1IjoibWF0aGlldWRhaXgiLCJhIjoiY2tiOWI5ODgzMGNmYTJ6cGlnOTh5bjI5ZCJ9.061wCTnhLhD99yEEmz5Osw",STYLE:"mapbox://styles/mathieudaix/ckkie2bdw0saz17pbidyjsgb4?optimize=true"}}),q={},x=c;Object.defineProperty(q,"__esModule",{value:!0});var A=void 0;q.default=A;var T=x(r),_=x(t),C=x(e),I=x(n),E=x(a);A=function(){function e(){(0,I.default)(this,e)}return(0,E.default)(e,[{key:"get",value:function(e,t){if("undefined"!=typeof document)t=document.cookie;else if(void 0===t)return!1;var r=t.split(";").map((function(e){var t=e.split("="),r=(0,C.default)(t),a=r[0],n=r.slice(1);return(0,_.default)({},a.trim(),decodeURIComponent(n.join("=")))}));return r[e]||r[0][e]}},{key:"set",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.days&&(r["max-age"]=60*r.days*60*24,delete r.days),r=Object.entries(r).reduce((function(e,t){var r=(0,T.default)(t,2),a=r[0],n=r[1];return"".concat(e,"; ").concat(a,"=").concat(n)}),""),document.cookie="".concat(e,"=").concat(encodeURIComponent(t)+r)}},{key:"delete",value:function(e){document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;")}}]),e}(),q.default=A;var L=m(q),R={};Object.defineProperty(R,"__esModule",{value:!0});var D=function(e,t,r){t.classList.add("active"),t.classList.add("msg-".concat(e)),t.innerText=r};R.default=D;var S=m(R);function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,g.default)(e);if(t){var n=(0,g.default)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,y.default)(this,r)}}var z=function(){function e(){(0,O.default)(this,e)}var t;return(0,P.default)(e,[{key:"request",value:(t=(0,k.default)(w.default.mark((function e(t){var r,a,n,u,s,o,i,d,c,l;return w.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.method,a=void 0===r?"GET":r,n=t.route,u=t.body,s=t.headersOverride,o=t.reqAdditional,i=new Headers(Object.assign({"Content-Type":"application/json"},s)),d=Object.assign({body:JSON.stringify(u)},o),c=Object.assign({method:a,headers:i,redirect:"follow"},d),e.next=6,fetch(j.default.DOMAIN_URL+n,c);case 6:return l=e.sent,e.next=9,l.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),U=z;h.default=U;var B=function(e){(0,b.default)(s,e);var t,r,a,n,u=M(s);function s(){var e;return(0,O.default)(this,s),(e=u.call(this)).msg=document.querySelector(".msg"),e}return(0,P.default)(s,[{key:"authenticate",value:(n=(0,k.default)(w.default.mark((function e(t){var r,a;return w.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"POST",route:"/auth/local",body:t});case 2:r=e.sent,(a=r.jwt)?((new L.default).set("jwt",a,{path:"/",days:30}),window.location.href="/app"):(0,S.default)("error",this.msg,"Invalid email adress or password.");case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"register",value:(a=(0,k.default)(w.default.mark((function e(t){var r;return w.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"POST",route:"/users",body:t});case 2:(r=e.sent).error?(0,S.default)("error",this.msg,r.message[0].messages[0].message):((0,S.default)("success",this.msg,"Your account has been created. You will be automatically redirected."),setTimeout((function(){return window.location.href="/auth/sign-in"}),3e3));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"forgotPassword",value:(r=(0,k.default)(w.default.mark((function e(t){var r;return w.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"POST",route:"/auth/forgot-password",body:t});case 2:(r=e.sent).error&&(0,S.default)("error",this.msg,r.message[0].messages[0].message);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"resetPassword",value:(t=(0,k.default)(w.default.mark((function e(t){var r;return w.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({method:"POST",route:"/auth/reset-password",body:t});case 2:(r=e.sent).error?(0,S.default)("error",this.msg,r.message[0].messages[0].message):((0,S.default)("success","You will receive an email in a few minutes."),setTimeout((function(){return window.location.href="/auth/sign-in"}),3e3));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"disconnect",value:function(){(new L.default).delete("jwt"),window.location.reload()}}]),s}(z);h.AuthApi=B,v=function(e){(0,b.default)(u,e);var t,r,a,n=M(u);function u(){var e;return(0,O.default)(this,u),(e=n.call(this)).cookies=new L.default,e.jwt=e.cookies.get("jwt"),e.authorization={Authorization:"Bearer ".concat(e.jwt)},e}return(0,P.default)(u,[{key:"renderLatestRoutes",value:(a=(0,k.default)(w.default.mark((function e(){return w.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({route:"/travels/me",headersOverride:this.authorization});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"renderGlobalStats",value:(r=(0,k.default)(w.default.mark((function e(){return w.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({route:"/users-global-stats/me",headersOverride:this.authorization});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"leaderboard",value:(t=(0,k.default)(w.default.mark((function e(){return w.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request({route:"/users-global-stats/leaderboard",headersOverride:this.authorization});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),u}(z),h.StatsApi=v;var G=l(f),J={};Object.defineProperty(J,"__esModule",{value:!0});var Y=function(){var e=document.getElementById("resetPassword");e.addEventListener("submit",(function(t){t.preventDefault();var r=new FormData(e),a=r.get("password"),n=r.get("passwordConfirm"),u=new URL(location).searchParams.get("code");(new h.AuthApi).resetPassword({code:u,password:a,passwordConfirmation:n})}))};J.default=Y;var F=l(J),N={};Object.defineProperty(N,"__esModule",{value:!0});var W=function(){var e=document.getElementById("signIn");e.addEventListener("submit",(function(t){t.preventDefault();var r=new FormData(e);(new h.AuthApi).authenticate({identifier:r.get("username"),password:r.get("password")})}))};N.default=W;var X=l(N),H={},K=c;Object.defineProperty(H,"__esModule",{value:!0});var Z=function(){var e=document.getElementById("signUp");e.addEventListener("submit",(function(t){t.preventDefault();var r=new FormData(e);r.get("password")===r.get("passwordConfirm")?(new h.AuthApi).register({method:"PUT",email:r.get("email"),username:r.get("username"),password:r.get("password")}):(0,Q.default)("error",document.querySelector(".msg"),"Passwords are not identical.")}))};H.default=Z;var Q=K(R);var V=l(H);window.auth={forgotPassword:G.default,resetPassword:F.default,signIn:X.default,signUp:V.default};